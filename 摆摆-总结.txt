2021.10.08
一、采集流程（基于STM32F407）
1、内部ADC + 温度传感器 + 串口
2、ADS1282 + SPI（通信协议）+ 串口
  最后调试没有成功，原因：
	主观：	对硬件涉及过少（不感兴趣），再加之未曾接触的过spi通信协议，使得难度进一步加大；
	客观：	ADS1282的资料过少，且大多数都是概括性、流程性的；
			已有的程序代码可读性不强，从代码中获取有效信息不多；
			易老师后又提出采样频率须达到50kHz，1282无法达到其要求。
3、下一步计划
	星晔寻找一片能达到采样频率且大众化的芯片。
	我着手于STM32与上位机基于网络通信进行数据传输的工作。
	
二、文献
	因此微震系统有多个检测装置需要同步传输数据，查看了一些在传感器数据同步传输方面的
期刊文献。其大多使用PTP协议（IEEEE1588），将上位机设置为主时钟，以校准多个传感器的时钟
而使其同步。而现在我们的项目不需要这么复杂，只需上位机发送一个同步脉冲，命令个传感器将
数据上传即可。

2021.10.14
一、上位机
1、上位机设计采用QT开源版本。
2、上位机网络通信，数据流采用TCP协议，指令采用UDP协议。
3、目前完成上位机TCP协议，单线程部分的程序，通过自发自收已验证通过。
4、程序主要流程：
	监听套接字 -> 连接套接字 -> 接收/发送数据
	QTcpServer类用于监听套接字；
	QTcpSocket类用于绑定套接字，发送/接收数据
5、多线程

二、下位机
1、下位机使用STM32开发板
2、下位机网络通信，数据流采用TCP协议，指令采用UDP协议。
3、下位机使用LAN8720 + LWIP协议与上位机进行网络通信，同时使用串口通信来查看下位机工作状况。
4、程序主要流程：
	内部AD转换获取温度 -> STM32发送给网络上位机和串口上位机
5、网络配置过程：
	LAN8720初始化（将32的一些引脚复用给8720） ->
	初始化LWIP内核 ->
	配置IP信息 ->
	将32设置为客户端，与上位机连接。

三、名词
socket套接字：对网络上每个节点的抽象，一个套接字就是网络通信进程的一端。
Socket简单地说，就是一个IP地址加一个port端口

四、下一步计划
1、由于电脑没有网络端口，无法测试上下位机之间的单线程通信，故而先进行上位机多线程通信开发。
2、UDP通信开发；
3、上、下位机之间的单线程通信。
4、使用github维护代码。


2021.10.15
〇、qt 服务器无法检测到客户端的断链。
一、上位机
尝试多线程网络编程，大致实现，但各线程的socket套接字用的是一个，导致前面的线程会被后面的抢占。
1、上位机多线程编程流程
	创建新类，继承QObject类；
	添加一个成员函数用于接收并处理数据；
	在主线程成中开启监听；
	当监听到一个客户端时，使用Qthread创建一个子线程，使用新类创建一个任务对象；
	利用MoveToThread函数将任务对象移到子线程中去；
	利用connnect函数启动任务对象的数据处理函数；
	利用Thread->start()函数启动子线程。
2、下一步计划
	在USB转网口还未到之前：
	测试UDP协议；
	解决socket套接字问题；
	解决服务器检测客户端断链；
	多线程资源回收；
	多线程临界资源互斥设置
	
2021.10.17
一、上位机
UDP通信完成，自测完成。

二、下位机
LAN8720直连笔记本，无法ping通。

2021.10.18
一、上位机

二、下位机
参考之前树莓派的连接方式进行修改
https://blog.csdn.net/sinat_35821976/article/details/107881644
未解决问题

最终解决：
不同厂家的LAN8720电路略有不同，引脚设置不一样
代码是正点原子的，LAN8720是微雪的
需要修改正点原子代码LAN8720_PHY_ADDRESS 的值为0x01才可正常使用

下位机程序流程：
	LAN8720初始化
	LWIP初始化
	设置客户端模式：IP，端口
	通过回调函数连接服务器
	添加内部定时器2，每2秒获取一次内部温度传感器的数值，并发给上位机

LAN8720：以太网PHY层芯片，通过RMII接口与以太网MAC层通信
	
########小结##########
STM32每隔一定时间采集内部温度传感器的温度，经AD转换之后，将数据发送给上位机。
下一步只需将内部AD数值换成星晔的AD数值即可。

